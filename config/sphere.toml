################################################################################
# sphere.toml
# Demonstrates complex curved geometry with nested spheres.
# Features a detailed outer sphere with a larger inner sphere to showcase
# multi-layer curved surface interactions and photon transport between layers.
# Lengths are in cm; mua and mus are in 1/cm.
################################################################################

[general]
photons = 10
voxel_size = 0.1
log = true
deterministic = false

[source]
position = [0.0, 0.9, 0.0]
direction = [0, -1, 0]

# Outer Layer: Detailed Sphere (UV Sphere with higher resolution - 32 segments)
[[layer]]
eta = 1.35
mua = 0.2     # Very low absorption for outer shell
mus = 15      # Medium scattering
ani = 0.3     # Slight forward scattering

vertices = [
    # Outer sphere vertices (radius 0.9, center at origin)
    # Top pole
    [ 0.000,  0.900,  0.000],  # 0: top
    
    # Ring 1 (latitude ~80°) - 8 segments
    [ 0.157,  0.886,  0.000],  # 1
    [ 0.111,  0.886,  0.111],  # 2
    [ 0.000,  0.886,  0.157],  # 3
    [-0.111,  0.886,  0.111],  # 4
    [-0.157,  0.886,  0.000],  # 5
    [-0.111,  0.886, -0.111],  # 6
    [ 0.000,  0.886, -0.157],  # 7
    [ 0.111,  0.886, -0.111],  # 8
    
    # Ring 2 (latitude ~60°) - 8 segments
    [ 0.450,  0.779,  0.000],  # 9
    [ 0.318,  0.779,  0.318],  # 10
    [ 0.000,  0.779,  0.450],  # 11
    [-0.318,  0.779,  0.318],  # 12
    [-0.450,  0.779,  0.000],  # 13
    [-0.318,  0.779, -0.318],  # 14
    [ 0.000,  0.779, -0.450],  # 15
    [ 0.318,  0.779, -0.318],  # 16
    
    # Ring 3 (latitude ~40°) - 8 segments
    [ 0.689,  0.579,  0.000],  # 17
    [ 0.487,  0.579,  0.487],  # 18
    [ 0.000,  0.579,  0.689],  # 19
    [-0.487,  0.579,  0.487],  # 20
    [-0.689,  0.579,  0.000],  # 21
    [-0.487,  0.579, -0.487],  # 22
    [ 0.000,  0.579, -0.689],  # 23
    [ 0.487,  0.579, -0.487],  # 24
    
    # Ring 4 (latitude ~20°) - 8 segments
    [ 0.847,  0.309,  0.000],  # 25
    [ 0.599,  0.309,  0.599],  # 26
    [ 0.000,  0.309,  0.847],  # 27
    [-0.599,  0.309,  0.599],  # 28
    [-0.847,  0.309,  0.000],  # 29
    [-0.599,  0.309, -0.599],  # 30
    [ 0.000,  0.309, -0.847],  # 31
    [ 0.599,  0.309, -0.599],  # 32
    
    # Ring 5 (equator) - 8 segments
    [ 0.900,  0.000,  0.000],  # 33
    [ 0.636,  0.000,  0.636],  # 34
    [ 0.000,  0.000,  0.900],  # 35
    [-0.636,  0.000,  0.636],  # 36
    [-0.900,  0.000,  0.000],  # 37
    [-0.636,  0.000, -0.636],  # 38
    [ 0.000,  0.000, -0.900],  # 39
    [ 0.636,  0.000, -0.636],  # 40
    
    # Ring 6 (latitude ~-20°) - 8 segments
    [ 0.847, -0.309,  0.000],  # 41
    [ 0.599, -0.309,  0.599],  # 42
    [ 0.000, -0.309,  0.847],  # 43
    [-0.599, -0.309,  0.599],  # 44
    [-0.847, -0.309,  0.000],  # 45
    [-0.599, -0.309, -0.599],  # 46
    [ 0.000, -0.309, -0.847],  # 47
    [ 0.599, -0.309, -0.599],  # 48
    
    # Ring 7 (latitude ~-40°) - 8 segments
    [ 0.689, -0.579,  0.000],  # 49
    [ 0.487, -0.579,  0.487],  # 50
    [ 0.000, -0.579,  0.689],  # 51
    [-0.487, -0.579,  0.487],  # 52
    [-0.689, -0.579,  0.000],  # 53
    [-0.487, -0.579, -0.487],  # 54
    [ 0.000, -0.579, -0.689],  # 55
    [ 0.487, -0.579, -0.487],  # 56
    
    # Ring 8 (latitude ~-60°) - 8 segments
    [ 0.450, -0.779,  0.000],  # 57
    [ 0.318, -0.779,  0.318],  # 58
    [ 0.000, -0.779,  0.450],  # 59
    [-0.318, -0.779,  0.318],  # 60
    [-0.450, -0.779,  0.000],  # 61
    [-0.318, -0.779, -0.318],  # 62
    [ 0.000, -0.779, -0.450],  # 63
    [ 0.318, -0.779, -0.318],  # 64
    
    # Ring 9 (latitude ~-80°) - 8 segments
    [ 0.157, -0.886,  0.000],  # 65
    [ 0.111, -0.886,  0.111],  # 66
    [ 0.000, -0.886,  0.157],  # 67
    [-0.111, -0.886,  0.111],  # 68
    [-0.157, -0.886,  0.000],  # 69
    [-0.111, -0.886, -0.111],  # 70
    [ 0.000, -0.886, -0.157],  # 71
    [ 0.111, -0.886, -0.111],  # 72
    
    # Bottom pole
    [ 0.000, -0.900,  0.000]   # 73: bottom
]

faces = [
    # Top cap triangles
    [0, 2, 1], [0, 3, 2], [0, 4, 3], [0, 5, 4], [0, 6, 5], [0, 7, 6], [0, 8, 7], [0, 1, 8],
    
    # Ring connections (quads split into triangles)
    # Ring 1 to Ring 2
    [1, 9, 10], [1, 10, 2], [2, 10, 11], [2, 11, 3], [3, 11, 12], [3, 12, 4],
    [4, 12, 13], [4, 13, 5], [5, 13, 14], [5, 14, 6], [6, 14, 15], [6, 15, 7],
    [7, 15, 16], [7, 16, 8], [8, 16, 9], [8, 9, 1],
    
    # Ring 2 to Ring 3
    [9, 17, 18], [9, 18, 10], [10, 18, 19], [10, 19, 11], [11, 19, 20], [11, 20, 12],
    [12, 20, 21], [12, 21, 13], [13, 21, 22], [13, 22, 14], [14, 22, 23], [14, 23, 15],
    [15, 23, 24], [15, 24, 16], [16, 24, 17], [16, 17, 9],
    
    # Ring 3 to Ring 4
    [17, 25, 26], [17, 26, 18], [18, 26, 27], [18, 27, 19], [19, 27, 28], [19, 28, 20],
    [20, 28, 29], [20, 29, 21], [21, 29, 30], [21, 30, 22], [22, 30, 31], [22, 31, 23],
    [23, 31, 32], [23, 32, 24], [24, 32, 25], [24, 25, 17],
    
    # Ring 4 to Ring 5 (equator)
    [25, 33, 34], [25, 34, 26], [26, 34, 35], [26, 35, 27], [27, 35, 36], [27, 36, 28],
    [28, 36, 37], [28, 37, 29], [29, 37, 38], [29, 38, 30], [30, 38, 39], [30, 39, 31],
    [31, 39, 40], [31, 40, 32], [32, 40, 33], [32, 33, 25],
    
    # Ring 5 to Ring 6
    [33, 41, 42], [33, 42, 34], [34, 42, 43], [34, 43, 35], [35, 43, 44], [35, 44, 36],
    [36, 44, 45], [36, 45, 37], [37, 45, 46], [37, 46, 38], [38, 46, 47], [38, 47, 39],
    [39, 47, 48], [39, 48, 40], [40, 48, 41], [40, 41, 33],
    
    # Ring 6 to Ring 7
    [41, 49, 50], [41, 50, 42], [42, 50, 51], [42, 51, 43], [43, 51, 52], [43, 52, 44],
    [44, 52, 53], [44, 53, 45], [45, 53, 54], [45, 54, 46], [46, 54, 55], [46, 55, 47],
    [47, 55, 56], [47, 56, 48], [48, 56, 49], [48, 49, 41],
    
    # Ring 7 to Ring 8
    [49, 57, 58], [49, 58, 50], [50, 58, 59], [50, 59, 51], [51, 59, 60], [51, 60, 52],
    [52, 60, 61], [52, 61, 53], [53, 61, 62], [53, 62, 54], [54, 62, 63], [54, 63, 55],
    [55, 63, 64], [55, 64, 56], [56, 64, 57], [56, 57, 49],
    
    # Ring 8 to Ring 9
    [57, 65, 66], [57, 66, 58], [58, 66, 67], [58, 67, 59], [59, 67, 68], [59, 68, 60],
    [60, 68, 69], [60, 69, 61], [61, 69, 70], [61, 70, 62], [62, 70, 71], [62, 71, 63],
    [63, 71, 72], [63, 72, 64], [64, 72, 65], [64, 65, 57],
    
    # Bottom cap triangles
    [73, 65, 66], [73, 66, 67], [73, 67, 68], [73, 68, 69], [73, 69, 70], [73, 70, 71], [73, 71, 72], [73, 72, 65]
]

normals = [
    # Normalized sphere normals (pointing outward)
    [ 0.000,  1.000,  0.000],  # top pole
    [ 0.309,  0.951,  0.000], [ 0.219,  0.951,  0.219], [ 0.000,  0.951,  0.309], [-0.219,  0.951,  0.219],
    [-0.309,  0.951,  0.000], [-0.219,  0.951, -0.219], [ 0.000,  0.951, -0.309], [ 0.219,  0.951, -0.219],
    [ 0.707,  0.707,  0.000], [ 0.500,  0.707,  0.500], [ 0.000,  0.707,  0.707], [-0.500,  0.707,  0.500],
    [-0.707,  0.707,  0.000], [-0.500,  0.707, -0.500], [ 0.000,  0.707, -0.707], [ 0.500,  0.707, -0.500],
    [ 1.000,  0.000,  0.000], [ 0.707,  0.000,  0.707], [ 0.000,  0.000,  1.000], [-0.707,  0.000,  0.707],
    [-1.000,  0.000,  0.000], [-0.707,  0.000, -0.707], [ 0.000,  0.000, -1.000], [ 0.707,  0.000, -0.707],
    [ 0.707, -0.707,  0.000], [ 0.500, -0.707,  0.500], [ 0.000, -0.707,  0.707], [-0.500, -0.707,  0.500],
    [-0.707, -0.707,  0.000], [-0.500, -0.707, -0.500], [ 0.000, -0.707, -0.707], [ 0.500, -0.707, -0.500],
    [ 0.309, -0.951,  0.000], [ 0.219, -0.951,  0.219], [ 0.000, -0.951,  0.309], [-0.219, -0.951,  0.219],
    [-0.309, -0.951,  0.000], [-0.219, -0.951, -0.219], [ 0.000, -0.951, -0.309], [ 0.219, -0.951, -0.219],
    [ 0.000, -1.000,  0.000]   # bottom pole
]

# Inner Layer: Large Inner Sphere (radius 0.6, more visible)
[[layer]]
eta = 1.45
mua = 1.5     # High absorption for inner sphere
mus = 5       # Lower scattering for contrast
ani = 0.8     # Strong forward scattering

vertices = [
    # Inner sphere vertices (radius 0.6, center at origin)
    # Top pole
    [ 0.000,  0.600,  0.000],  # 0: top
    
    # Ring 1 (latitude ~60°) - 8 segments
    [ 0.300,  0.520,  0.000],  # 1
    [ 0.212,  0.520,  0.212],  # 2
    [ 0.000,  0.520,  0.300],  # 3
    [-0.212,  0.520,  0.212],  # 4
    [-0.300,  0.520,  0.000],  # 5
    [-0.212,  0.520, -0.212],  # 6
    [ 0.000,  0.520, -0.300],  # 7
    [ 0.212,  0.520, -0.212],  # 8
    
    # Ring 2 (latitude ~30°) - 8 segments
    [ 0.520,  0.300,  0.000],  # 9
    [ 0.368,  0.300,  0.368],  # 10
    [ 0.000,  0.300,  0.520],  # 11
    [-0.368,  0.300,  0.368],  # 12
    [-0.520,  0.300,  0.000],  # 13
    [-0.368,  0.300, -0.368],  # 14
    [ 0.000,  0.300, -0.520],  # 15
    [ 0.368,  0.300, -0.368],  # 16
    
    # Ring 3 (equator) - 8 segments
    [ 0.600,  0.000,  0.000],  # 17
    [ 0.424,  0.000,  0.424],  # 18
    [ 0.000,  0.000,  0.600],  # 19
    [-0.424,  0.000,  0.424],  # 20
    [-0.600,  0.000,  0.000],  # 21
    [-0.424,  0.000, -0.424],  # 22
    [ 0.000,  0.000, -0.600],  # 23
    [ 0.424,  0.000, -0.424],  # 24
    
    # Ring 4 (latitude ~-30°) - 8 segments
    [ 0.520, -0.300,  0.000],  # 25
    [ 0.368, -0.300,  0.368],  # 26
    [ 0.000, -0.300,  0.520],  # 27
    [-0.368, -0.300,  0.368],  # 28
    [-0.520, -0.300,  0.000],  # 29
    [-0.368, -0.300, -0.368],  # 30
    [ 0.000, -0.300, -0.520],  # 31
    [ 0.368, -0.300, -0.368],  # 32
    
    # Ring 5 (latitude ~-60°) - 8 segments
    [ 0.300, -0.520,  0.000],  # 33
    [ 0.212, -0.520,  0.212],  # 34
    [ 0.000, -0.520,  0.300],  # 35
    [-0.212, -0.520,  0.212],  # 36
    [-0.300, -0.520,  0.000],  # 37
    [-0.212, -0.520, -0.212],  # 38
    [ 0.000, -0.520, -0.300],  # 39
    [ 0.212, -0.520, -0.212],  # 40
    
    # Bottom pole
    [ 0.000, -0.600,  0.000]   # 41: bottom
]

faces = [
    # Inner sphere faces
    # Top cap - connect pole to first ring
    [ 0,  2,  1], [ 0,  3,  2], [ 0,  4,  3], [ 0,  5,  4],
    [ 0,  6,  5], [ 0,  7,  6], [ 0,  8,  7], [ 0,  1,  8],
    
    # Ring 1 to Ring 2
    [ 1, 10,  9], [ 1,  2, 10], [ 2, 11, 10], [ 2,  3, 11], [ 3, 12, 11], [ 3,  4, 12],
    [ 4, 13, 12], [ 4,  5, 13], [ 5, 14, 13], [ 5,  6, 14], [ 6, 15, 14], [ 6,  7, 15],
    [ 7, 16, 15], [ 7,  8, 16], [ 8,  9, 16], [ 8,  1,  9], [ 9, 10, 16], [16, 10,  9],
    
    # Ring 2 to Ring 3 (equator)
    [ 9, 18, 17], [ 9, 10, 18], [10, 19, 18], [10, 11, 19], [11, 20, 19], [11, 12, 20],
    [12, 21, 20], [12, 13, 21], [13, 22, 21], [13, 14, 22], [14, 23, 22], [14, 15, 23],
    [15, 24, 23], [15, 16, 24], [16, 17, 24], [16,  9, 17], [17, 18, 24], [24, 18, 17],
    
    # Ring 3 to Ring 4
    [17, 26, 25], [17, 18, 26], [18, 27, 26], [18, 19, 27], [19, 28, 27], [19, 20, 28],
    [20, 29, 28], [20, 21, 29], [21, 30, 29], [21, 22, 30], [22, 31, 30], [22, 23, 31],
    [23, 32, 31], [23, 24, 32], [24, 25, 32], [24, 17, 25], [25, 26, 32], [32, 26, 25],
    
    # Ring 4 to Ring 5
    [25, 34, 33], [25, 26, 34], [26, 35, 34], [26, 27, 35], [27, 36, 35], [27, 28, 36],
    [28, 37, 36], [28, 29, 37], [29, 38, 37], [29, 30, 38], [30, 39, 38], [30, 31, 39],
    [31, 40, 39], [31, 32, 40], [32, 33, 40], [32, 25, 33], [33, 34, 40], [40, 34, 33],
    
    # Bottom cap - connect last ring to pole
    [33, 41, 34], [34, 41, 35], [35, 41, 36], [36, 41, 37],
    [37, 41, 38], [38, 41, 39], [39, 41, 40], [40, 41, 33]
]

normals = [
    # Normalized sphere normals for inner sphere (pointing outward)
    [ 0.000,  1.000,  0.000],  # 0: top pole
    
    # Ring 1 normals (latitude ~60°)
    [ 0.500,  0.866,  0.000], [ 0.354,  0.866,  0.354], [ 0.000,  0.866,  0.500], [-0.354,  0.866,  0.354],
    [-0.500,  0.866,  0.000], [-0.354,  0.866, -0.354], [ 0.000,  0.866, -0.500], [ 0.354,  0.866, -0.354],
    
    # Ring 2 normals (latitude ~30°)
    [ 0.866,  0.500,  0.000], [ 0.612,  0.500,  0.612], [ 0.000,  0.500,  0.866], [-0.612,  0.500,  0.612],
    [-0.866,  0.500,  0.000], [-0.612,  0.500, -0.612], [ 0.000,  0.500, -0.866], [ 0.612,  0.500, -0.612],
    
    # Ring 3 normals (equator)
    [ 1.000,  0.000,  0.000], [ 0.707,  0.000,  0.707], [ 0.000,  0.000,  1.000], [-0.707,  0.000,  0.707],
    [-1.000,  0.000,  0.000], [-0.707,  0.000, -0.707], [ 0.000,  0.000, -1.000], [ 0.707,  0.000, -0.707],
    
    # Ring 4 normals (latitude ~-30°)
    [ 0.866, -0.500,  0.000], [ 0.612, -0.500,  0.612], [ 0.000, -0.500,  0.866], [-0.612, -0.500,  0.612],
    [-0.866, -0.500,  0.000], [-0.612, -0.500, -0.612], [ 0.000, -0.500, -0.866], [ 0.612, -0.500, -0.612],
    
    # Ring 5 normals (latitude ~-60°)
    [ 0.500, -0.866,  0.000], [ 0.354, -0.866,  0.354], [ 0.000, -0.866,  0.500], [-0.354, -0.866,  0.354],
    [-0.500, -0.866,  0.000], [-0.354, -0.866, -0.354], [ 0.000, -0.866, -0.500], [ 0.354, -0.866, -0.354],
    
    # Bottom pole
    [ 0.000, -1.000,  0.000]   # 41: bottom pole
]